uses sdpGPS, sdpBYPASS, sdpUtils, sdpItem, sdpSTRINGS, sysUtils;
const
pplname: string = 'lllwlk';
initiatorName: string = 'lbd';

procedure OnAction(Action: TL2Action; P1, P2: pointer);
  begin
    if Action = laCast then begin
      Script.NewThread(
          @OnSomeoneCasting, P1
      );
    end;
  end;
procedure OnSomeoneCasting(caster: TL2Char);
  var color: Integer;
  begin
    if (caster.Name = initiatorName) and ((caster.Cast.Name = 'Dance of Fury') or (caster.Cast.Name = 'Dance of the Mystic'))
    then Cast()
    else if (caster.cast.name <> 'Soulshot (D-grade)')
        and (caster.cast.name <> 'Blessed Spiritshot (No-grade)')
        and (caster.cast.name <> 'Blessed Spiritshot (D-grade)')
        and (caster.cast.name <> 'Blessed Spiritshot (C-grade)')
        and (caster.cast.name <> 'Item - Beast Soul Shot')
    then begin
      if (Caster.Clan =  User.Clan) or (Caster.IsMember)
      then color := $228B22
      else color := $4763FF;
      Engine.Msg('Casting',
     '['+caster.name+']       ' + caster.cast.name + '->' + caster.Target.Name
     , color);
    end
    else begin end;
    
  end;
procedure Cast();
  begin
    Engine.FaceControl(1, false);
//    Engine.MoveTo(User.X+25, User.Y, User.Z);
//    Delay(333);
    Delay(User.Cast.EndTime);
    if User.ClassId = 21 then
    begin
      if (User.MP > 90) then Delay(200);
        Engine.UseSkill('Song of Warding');
//        Engine.UseSkill('Song of Earth');
//        Engine.UseSkill('Hunter''s Song');
      Engine.UseSkill('Song of Wind');
    end
    else if User.ClassId = 34 then begin
        Engine.UseSkill('Dance of Concentration');
//      Engine.UseSkill('Dance of the Mystic');
//       Engine.UseSkill('Dance of Fury');
//       Engine.UseSkill('Dance of Fire');
//       Engine.UseSkill('Dance of the Warrior');
    end
    else if User.ClassId = 14 then begin
      Engine.UseAction(1007);
    end
    else if User.Classid = 28 then begin
      Engine.UseAction(1011);
    end;
    Engine.FaceControl(1, true);
  end;

begin
// GPS_MoveTo('gludio gludin'); Engine.unstuck; Delay(60000); Engine.BlinkWindow(true);
  //GPS_MoveToClosest('safe1;safe2;safe3;safe4;safe5;safe6;safe7;safe8;safe9');
//  GPS_MoveTo('hnt:delf prie juros'); Engine.FaceControl(0, true);
//  cmd(path);
//  Engine.Blinkwindow(true);
// CB('_bbsmultisell;index2;99999991');
//Engine.ByPassToServer('_bbsmultisell;index2;99999991');
Delay(-1);
end.