uses sdpGPS, sdpBYPASS, sdpUtils, sdpItem, sdpSTRINGS, sysUtils;
const
pplname: string = 'lllwlk';
initiatorName: string = 'lbd';
procedure OnAction(Action: TL2Action; P1, P2: pointer);
  begin
    if Action = laCast then begin
      Script.NewThread(
          @OnSomeoneCasting, P1
      );
    end;
  end;
procedure OnSomeoneCasting(caster: TL2Char);
  var color: Integer;
  begin
    if (caster.Name = initiatorName)
   and (caster.Cast.Name = 'Dance of Fury')
   then begin
     Engine.FaceControl(1, false);
//     Engine.MoveTo(User.X+25, User.Y, User.Z);
//     Delay(333);
     if User.ClassId = 21 then begin
       if (User.MP > 90) then Delay(200);
//       Engine.UseSkill('Song of Warding');
       Engine.UseSkill('Song of Earth');
       Engine.UseSkill('Hunter''s Song');
       Delay(150);
       Engine.UseSkill('Song of Wind');

       if (User.Level >= 55) then begin
         if (pplname <> '') then
         begin
           Engine.LeaveParty;
           Delay(110*1000);
           GetControl(pplname).InviteParty(User.Name);
         end;
       end;
     end
     else if User.ClassId = 34 then begin
       Delay(User.Cast.EndTime);
//       Engine.UseSkill('Dance of Concentration');
//       Engine.UseSkill('Dance of the Mystic');
//       if (User.MP > 50) then
//       Engine.UseSkill('Dance of Fury');
       Engine.UseSkill('Dance of Fire');
       Engine.UseSkill('Dance of the Warrior');
       
     
     end
     else if User.ClassId = 14 then begin
       Engine.UseAction(1007);
     end;
     Engine.FaceControl(1, true);
   end
   else if
    (caster.cast.name <> 'Soulshot (D-grade)')
    and (caster.cast.name <> 'Blessed Spiritshot (No-grade)')
    and (caster.cast.name <> 'Blessed Spiritshot (D-grade)')
    and (caster.cast.name <> 'Blessed Spiritshot (C-grade)')
    and (caster.cast.name <> 'Item - Beast Soul Shot')
   then
   begin
     if (Caster.Clan =  User.Clan) or (Caster.IsMember)
     then color := $228B22
     else color := $4763FF;
     Engine.Msg('Casting',
     '['+caster.name+']       ' + caster.cast.name + '->' + caster.Target.Name
     , color);
   end;
  end;

begin
// GPS_MoveTo('gludio gludin'); Engine.unstuck; Delay(60000); Engine.BlinkWindow(true);
  //GPS_MoveToClosest('safe1;safe2;safe3;safe4;safe5;safe6;safe7;safe8;safe9');
//  GPS_MoveTo('hnt:delf prie juros'); Engine.FaceControl(0, true);
//  cmd(path);
//  Engine.Blinkwindow(true);
// CB('_bbsmultisell;index2;99999991');
//Engine.ByPassToServer('_bbsmultisell;index2;99999991');
Delay(-1);
end.